# Token Budget Distribution Analysis

**Date**: 2026-02-09
**Analyst**: context-engineer
**Project**: ai-assistants
**Budget ceiling**: ~8,500 tokens (~29,750 chars) for always-loaded content
**Previous report**: `TOKEN_BUDGETING_2026-02-09_11-56-42.md`
**Note**: Historical analysis. File references may be outdated (e.g., `software-agents-usage.md` renamed to `swe-agent-coordination-protocol.md`, `agents/references/sentinel-checks.md` internalized into `agents/sentinel.md`).

---

## Executive Summary

The always-loaded context now consumes **~28,573 characters (~8,164 tokens)**, which is **under the 8,500-token budget ceiling** by ~336 tokens (3.9% headroom). This represents a **5,209-character reduction (15.4%)** from the previous report's 33,782 chars (~9,652 tokens), achieved through compression of three rules (`software-agents-usage.md`, `readme-style.md`, `agent-intermediate-documents.md`) and extraction of pipeline coordination details into a reference file.

On-demand artifacts have also improved. Three skills (`python-development`, `software-planning`, `skill-crafting`) were restructured for better progressive disclosure, with SKILL.md reductions of 44.3%, 30.6%, and 17.4% respectively. Six new reference files were created to house the extracted content.

---

## 1. Comparison with Previous Report

### 1.1 Always-Loaded: Side-by-Side

| Artifact | Previous (chars) | Current (chars) | Delta | Notes |
|----------|----------------:|--------------:|------:|-------|
| Global CLAUDE.md | 2,697 | 2,697 | 0 | Unchanged |
| Project CLAUDE.md | 3,086 | 3,101 | +15 | Minor edit |
| Rule: software-agents-usage | 8,719 | 5,570 | **-3,149** | Compressed; pipeline diagram moved to reference |
| Rule: readme-style | 4,719 | 3,541 | **-1,178** | Condensed sections |
| Rule: coding-style | 4,505 | 4,505 | 0 | Unchanged |
| Rule: agent-intermediate-documents | 3,903 | 3,006 | **-897** | Compressed tables and prose |
| Rule: git-commit-hygiene | 1,134 | 1,134 | 0 | Unchanged |
| Rule: git-commit-message-format | 950 | 950 | 0 | Unchanged |
| userPreferences.txt | 2,143 | 2,143 | 0 | Unchanged |
| Project Memory | 1,926 | 1,926 | 0 | Unchanged |
| **TOTAL** | **33,782** | **28,573** | **-5,209** | |

### 1.2 Budget Status Comparison

| Metric | Previous | Current | Change |
|--------|----------|---------|--------|
| Total chars | 33,782 | 28,573 | -5,209 (-15.4%) |
| Est. tokens | ~9,652 | ~8,164 | -1,488 (-15.4%) |
| Budget ceiling (tokens) | 8,500 | 8,500 | -- |
| Over/under budget | +1,152 (13.5% over) | **-336 (3.9% under)** | Now compliant |

### 1.3 What Changed

Three optimization actions were executed between reports:

1. **`software-agents-usage.md` compressed (-3,149 chars)**: The Coordination Pipeline diagram, Parallel Execution protocols, and context-engineer engagement details were moved to `rules/swe/references/agent-coordination-protocols.md`. Tables were condensed. This single change accounted for 60% of the total reduction.

2. **`readme-style.md` compressed (-1,178 chars)**: Mandatory Exclusions, Structural Integrity, and Writing Quality sections were condensed. Overlapping content with the `doc-management` skill was removed from the rule.

3. **`agent-intermediate-documents.md` compressed (-897 chars)**: Document Lifecycle table and Version Control section were tightened. Verbose prose was replaced with concise declarative statements.

The rules reference file `agent-coordination-protocols.md` grew from 5,415 to 7,234 chars (+1,819) to absorb the content moved out of `software-agents-usage.md`. This is a net-positive trade: the reference loads on demand rather than always.

### 1.4 Skill Progressive Disclosure Improvements

| Skill | Previous SKILL.md | Current SKILL.md | Reduction | New Ref Files |
|-------|------------------:|----------------:|---------:|:------|
| python-development | 11,260 | 6,277 | -4,983 (44.3%) | `references/patterns-and-examples.md`, `references/testing-and-tooling.md` |
| software-planning | 17,085 | 11,866 | -5,219 (30.6%) | `contexts/python.md`, `references/decomposition-guide.md` |
| skill-crafting | 16,672 | 13,773 | -2,899 (17.4%) | `references/artifact-naming.md`, `references/patterns-and-troubleshooting.md` |

### 1.5 Other Changes Since Previous Report

| Artifact | Previous | Current | Notes |
|----------|--------:|-------:|-------|
| researcher memory | 3,453 | 4,671 | +1,218 chars from accumulated learnings |
| settings.local.json | 16,821 | 15,876 | -945 chars (config cleanup) |
| skill-crafting refs | 10,153 | 15,985 | +5,832 (2 new ref files from extraction) |
| software-planning refs | 10,197 | 18,925 | +8,728 (2 new ref files from extraction) |
| python-development refs | 0 | 7,482 | +7,482 (2 new ref files from extraction) |

---

## 2. Always-Loaded Artifacts

These are injected into every Claude Code conversation for this project.

### 2.1 Detailed Breakdown

| Artifact | File | Chars | Est. Tokens | % of Always-Loaded |
|----------|------|------:|------------:|--------------------:|
| **Global CLAUDE.md** | `~/.claude/CLAUDE.md` | 2,697 | 771 | 9.4% |
| **Project CLAUDE.md** | `CLAUDE.md` | 3,101 | 886 | 10.9% |
| **Rule: software-agents-usage** | `rules/swe/software-agents-usage.md` | 5,570 | 1,591 | 19.5% |
| **Rule: coding-style** | `rules/swe/coding-style.md` | 4,505 | 1,287 | 15.8% |
| **Rule: readme-style** | `rules/writing/readme-style.md` | 3,541 | 1,012 | 12.4% |
| **Rule: agent-intermediate-documents** | `rules/swe/agent-intermediate-documents.md` | 3,006 | 859 | 10.5% |
| **Rule: git-commit-hygiene** | `rules/swe/vcs/git-commit-hygiene.md` | 1,134 | 324 | 4.0% |
| **Rule: git-commit-message-format** | `rules/swe/vcs/git-commit-message-format.md` | 950 | 271 | 3.3% |
| **userPreferences.txt** | `~/.claude/userPreferences.txt` | 2,143 | 612 | 7.5% |
| **Project Memory** | `projects/.../memory/MEMORY.md` | 1,926 | 550 | 6.7% |
| | | | | |
| **TOTAL** | | **28,573** | **~8,164** | **100%** |

### 2.2 Budget Analysis

| Metric | Value |
|--------|-------|
| Budget ceiling (chars) | 29,750 |
| Budget ceiling (tokens) | ~8,500 |
| Actual usage (chars) | 28,573 |
| Actual usage (tokens) | ~8,164 |
| **Under budget by** | **~1,177 chars / ~336 tokens (3.9%)** |

**Note on `userPreferences.txt`**: This file (2,143 chars) is loaded by Claude Code as part of user preferences. Whether it counts against the "always-loaded context artifacts" budget is debatable -- it is a Claude platform feature, not a project artifact. Excluding it brings the total to **26,430 chars (~7,551 tokens)**, giving **11.2% headroom** under budget.

### 2.3 Category Distribution

| Category | Chars | Est. Tokens | % of Total |
|----------|------:|------------:|-----------:|
| Rules (6 files) | 18,706 | 5,345 | 65.5% |
| CLAUDE.md files (2) | 5,798 | 1,657 | 20.3% |
| userPreferences.txt | 2,143 | 612 | 7.5% |
| Project Memory | 1,926 | 550 | 6.7% |

Rules remain the dominant category at **65.5%** (down from 70.8%), but the `software-agents-usage.md` rule dropped from 25.8% to 19.5% of the total after compression.

### 2.4 Implicit Always-Loaded: Skill & Command Metadata

Claude Code injects a skill/command listing block into the system prompt for activation decisions. This is NOT counted in the budget above because it is generated by the platform, but it consumes context window space.

| Metadata Type | Est. Chars | Est. Tokens |
|---------------|----------:|------------:|
| Skill descriptions (11 skills + 7 commands) | ~5,100 | ~1,457 |
| Agent descriptions (9 agents, ~50 words each) | ~2,700 | ~771 |
| **Subtotal** | **~7,800** | **~2,229** |

Including this platform overhead, the effective always-loaded footprint is **~36,373 chars (~10,392 tokens)**.

---

## 3. On-Demand Artifacts: Skills

Skills load their SKILL.md when activated. Reference/satellite files load on further demand.

### 3.1 Skill Size Catalog

| Skill | SKILL.md (chars) | SKILL.md (tokens) | Reference Files (chars) | Total with Refs (chars) | Total Tokens |
|-------|-----------------:|-------------------:|------------------------:|------------------------:|-------------:|
| skill-crafting | 13,773 | 3,935 | 15,985 | 29,758 | 8,502 |
| software-planning | 11,866 | 3,390 | 18,925 | 30,791 | 8,797 |
| doc-management | 11,103 | 3,172 | 15,559 | 26,662 | 7,618 |
| rule-crafting | 11,080 | 3,166 | 7,987 | 19,067 | 5,448 |
| mcp-crafting | 9,335 | 2,667 | 23,269 | 32,604 | 9,315 |
| agent-crafting | 8,668 | 2,477 | 13,693 | 22,361 | 6,389 |
| command-crafting | 7,261 | 2,075 | 4,187 | 11,448 | 3,271 |
| refactoring | 7,078 | 2,022 | 5,309 | 12,387 | 3,539 |
| python-prj-mgmt | 7,066 | 2,019 | 28,323 | 35,389 | 10,111 |
| python-development | 6,277 | 1,793 | 7,482 | 13,759 | 3,931 |
| code-review | 5,015 | 1,433 | 2,174 | 7,189 | 2,054 |

### 3.2 Skill Size Distribution

**Largest SKILL.md files** (activation-time cost):
1. `skill-crafting` -- 13,773 chars (3,935 tokens)
2. `software-planning` -- 11,866 chars (3,390 tokens)
3. `doc-management` -- 11,103 chars (3,172 tokens)

**Largest total footprints** (SKILL.md + all references):
1. `python-prj-mgmt` -- 35,389 chars (10,111 tokens) -- driven by `pixi.md` (16,025) and `uv.md` (12,298)
2. `mcp-crafting` -- 32,604 chars (9,315 tokens)
3. `software-planning` -- 30,791 chars (8,797 tokens)

**Smallest** (most token-efficient):
1. `code-review` -- 7,189 chars total (2,054 tokens)
2. `command-crafting` -- 11,448 chars total (3,271 tokens)
3. `refactoring` -- 12,387 chars total (3,539 tokens)

### 3.3 Progressive Disclosure Effectiveness

| Skill | SKILL.md % of Total | References % | Disclosure Ratio | Change |
|-------|--------------------:|-------------:|-----------------:|--------|
| python-prj-mgmt | 20.0% | 80.0% | Excellent -- 80% deferred | Unchanged |
| python-development | 45.6% | 54.4% | Good | **Improved** (was 100% / None) |
| mcp-crafting | 28.6% | 71.4% | Excellent | Unchanged |
| agent-crafting | 38.8% | 61.2% | Good | Unchanged |
| software-planning | 38.5% | 61.5% | Good | **Improved** (was 62.6% / Moderate) |
| doc-management | 41.6% | 58.4% | Good | Unchanged |
| skill-crafting | 46.3% | 53.7% | Good | **Improved** (was 62.2% / Moderate) |
| rule-crafting | 58.1% | 41.9% | Moderate | Unchanged |
| refactoring | 57.1% | 42.9% | Moderate | Unchanged |
| command-crafting | 63.4% | 36.6% | Moderate | Unchanged |
| code-review | 69.8% | 30.2% | Low -- most content in SKILL.md | Unchanged |

All three targeted skills improved their disclosure ratio, with `python-development` seeing the most dramatic shift (from None to Good).

---

## 4. On-Demand Artifacts: Commands

| Command | Chars | Est. Tokens |
|---------|------:|------------:|
| add-rules | 2,064 | 590 |
| create-simple-python-prj | 1,564 | 447 |
| manage-readme | 1,306 | 373 |
| cop | 786 | 225 |
| co | 726 | 207 |
| merge-worktree | 631 | 180 |
| create-worktree | 553 | 158 |
| **Total** | **7,630** | **~2,180** |

Commands are compact. The entire command catalog is smaller than any single skill. Unchanged from previous report.

---

## 5. On-Demand Artifacts: Agents

Agent definitions load only in spawned context windows, NOT in the parent conversation. They carry their own context budget.

### 5.1 Agent Definition Sizes

| Agent | Chars | Est. Tokens |
|-------|------:|------------:|
| promethean | 15,496 | 4,427 |
| context-engineer | 15,361 | 4,389 |
| sentinel | 14,118 | 4,034 |
| implementation-planner | 13,920 | 3,977 |
| systems-architect | 11,503 | 3,287 |
| doc-engineer | 10,222 | 2,920 |
| researcher | 10,178 | 2,908 |
| verifier | 9,639 | 2,754 |
| implementer | 7,518 | 2,148 |
| **Total** | **107,955** | **~30,844** |

**Agent reference file**: `agents/references/sentinel-checks.md` -- 9,038 chars (2,582 tokens). Loaded by the sentinel agent on demand.

### 5.2 Agent Memory Files

Each agent has a persistent MEMORY.md loaded into its spawned context window.

| Agent | Memory Chars | Memory Tokens | Change |
|-------|------------:|-------------:|--------|
| implementation-planner | 4,683 | 1,338 | Unchanged |
| researcher | 4,671 | 1,335 | **+1,218** (was 3,453) |
| verifier | 2,429 | 694 | Unchanged |
| context-engineer | 2,170 | 620 | Unchanged |
| promethean | 1,597 | 456 | Unchanged |
| sentinel | 1,560 | 446 | Unchanged |
| systems-architect | 1,516 | 433 | Unchanged |
| doc-engineer | 1,107 | 316 | Unchanged |
| implementer | 768 | 219 | Unchanged |
| **Total** | **20,501** | **~5,857** | **+1,218** (was 19,283) |

### 5.3 Agent Spawned Context Budget

When an agent spawns, its context includes: baseline always-loaded + agent definition + agent memory + any skills it uses.

| Agent | Definition | Memory | Skills | Est. Total (tokens) |
|-------|----------:|-------:|-------:|--------------------:|
| implementer | 2,148 | 219 | ~10,120 (3 skills) | ~20,651 |
| sentinel | 4,034 | 446 | 0 | ~12,644 |
| context-engineer | 4,389 | 620 | varies | ~13,173+ |
| researcher | 2,908 | 1,335 | 0 | ~12,407 |
| promethean | 4,427 | 456 | 0 | ~13,047 |

Note: These estimates include the ~8,164 baseline always-loaded tokens (down from ~9,652).

---

## 6. System Overhead

| Component | Chars | Tokens | Loading Behavior |
|-----------|------:|-------:|------------------|
| `plugin.json` | 1,216 | 347 | Parsed at plugin install; metadata extracted for runtime |
| `settings.local.json` | 15,876 | 4,536 | Parsed by Claude Code for permissions; not injected into context |
| `claude_desktop_config.json` | 993 | 284 | Claude Desktop only; MCP server config |
| `PLUGIN_SCHEMA_NOTES.md` | 3,745 | 1,070 | Never auto-loaded; reference doc |

**Rules reference file**: `rules/swe/references/agent-coordination-protocols.md` -- 7,234 chars (2,067 tokens). NOT always-loaded; loaded on demand when rules reference it. Grew from 5,415 to 7,234 chars (+1,819) to absorb content moved from `software-agents-usage.md`.

**Rules README**: `rules/README.md` -- 10,983 chars (3,138 tokens). NOT installed as a rule and NOT always-loaded.

**MCP tool descriptions**: The task-chronograph MCP server registers tools whose descriptions are injected into the context. Exact size depends on the number of tools exposed by the server -- not measured here as it requires a running server instance.

---

## 7. Usage Pattern Scenarios

### Scenario 1: Baseline (Always-Loaded Only)

The minimum context footprint for any conversation in this project.

| Component | Tokens |
|-----------|-------:|
| CLAUDE.md files (2) | 1,657 |
| Rules (6) | 5,345 |
| userPreferences.txt | 612 |
| Project Memory | 550 |
| Skill/command/agent metadata | ~2,229 |
| **Total** | **~10,392** |

### Scenario 2: Single Skill Activation (Baseline + code-review)

A lightweight review session using the smallest skill.

| Component | Tokens |
|-----------|-------:|
| Baseline | 10,392 |
| code-review SKILL.md | 1,433 |
| **Total** | **~11,825** |

### Scenario 3: Pipeline Execution (Researcher -> Architect -> Planner)

Each agent runs in a separate context window. The parent conversation just tracks progress.

**Parent conversation:**
| Component | Tokens |
|-----------|-------:|
| Baseline | 10,392 |
| Pipeline document reads (RESEARCH_FINDINGS, SYSTEMS_PLAN, etc.) | ~3,000-8,000 |
| **Total** | **~13,500-18,500** |

**Per spawned agent (approximate):**
| Agent | Baseline | Definition | Memory | Skills | Total |
|-------|-------:|----------:|-------:|-------:|------:|
| researcher | 8,164 | 2,908 | 1,335 | 0 | ~12,407 |
| systems-architect | 8,164 | 3,287 | 433 | 0 | ~11,884 |
| implementation-planner | 8,164 | 3,977 | 1,338 | ~3,390 | ~16,869 |

### Scenario 4: Heavy Skill Session (Baseline + 3 Skills)

A Python development session using python-development, python-prj-mgmt (with pixi ref), and refactoring.

| Component | Tokens |
|-----------|-------:|
| Baseline | 10,392 |
| python-development SKILL.md | 1,793 |
| python-prj-mgmt SKILL.md | 2,019 |
| python-prj-mgmt/pixi.md (reference) | 4,579 |
| refactoring SKILL.md | 2,022 |
| **Total** | **~20,805** |

### Scenario 5: Full Context Pressure (Worst Case)

Baseline + 4 skills activated with all references + pipeline documents in conversation.

| Component | Tokens |
|-----------|-------:|
| Baseline | 10,392 |
| skill-crafting (full) | 8,502 |
| agent-crafting (full) | 6,389 |
| rule-crafting (full) | 5,448 |
| command-crafting (full) | 3,271 |
| Pipeline docs in conversation | ~5,000 |
| Conversation history | ~15,000+ |
| **Total** | **~54,002+** |

This approaches significant context window utilization but remains well within Claude's 200k context limit.

---

## 8. Optimization Opportunities

### 8.1 Resolved: Always-Loaded Budget (Previously Critical)

The always-loaded budget overrun identified in the previous report has been resolved. The total dropped from 33,782 to 28,573 chars (~9,652 to ~8,164 tokens), bringing it under the 8,500-token ceiling with 3.9% headroom.

**Remaining headroom**: ~1,177 chars / ~336 tokens available before hitting the budget ceiling. This is tight -- any new rule or significant expansion of existing rules should be evaluated against this margin.

### 8.2 Important: Headroom Is Thin

With only 336 tokens of headroom, the budget is fragile:
- Adding a new rule of even moderate size (>1,177 chars) would exceed the budget
- Growth in Project Memory or CLAUDE.md files will erode the margin
- Any future rule additions should consider whether existing rules can be further compressed or whether the content belongs in a skill instead

### 8.3 Suggested: Further Progressive Disclosure Candidates

| Skill | SKILL.md Size | Disclosure Rating | Opportunity |
|-------|-------------:|:-----------------:|-------------|
| `code-review` | 5,015 | Low (69.8%) | Could extract checklist patterns to a reference file |
| `command-crafting` | 7,261 | Moderate (63.4%) | Could extract examples to a reference file |
| `rule-crafting` | 11,080 | Moderate (58.1%) | At 11k chars, extracting examples would reduce activation cost |

These are not urgent -- activation-time cost for skills is acceptable. But if any of these skills grow, extraction should be considered.

### 8.4 Suggested: Memory File Growth Monitoring

Agent memories total 20,501 chars across 9 agents (+1,218 from previous report, driven by researcher memory growth from 3,453 to 4,671). The `implementation-planner` memory at 4,683 chars and `researcher` memory at 4,671 chars are the largest. Periodically review agent memories for staleness to prevent unbounded growth.

### 8.5 Suggested: Reference File Sizes

| Reference File | Chars | Issue |
|----------------|------:|-------|
| `python-prj-mgmt/pixi.md` | 16,025 | Largest single reference file; consider splitting into quick-ref + full-ref |
| `python-prj-mgmt/uv.md` | 12,298 | Large but acceptable for a comprehensive tool guide |
| `mcp-crafting/contexts/python.md` | 10,549 | Large context module |

---

## 9. Artifact Ecosystem Summary

### Total Content Inventory

| Category | Files | Total Chars | Total Tokens |
|----------|------:|------------:|-------------:|
| Always-loaded (CLAUDE.md + rules + prefs + memory) | 10 | 28,573 | ~8,164 |
| Skills (SKILL.md only) | 11 | 98,522 | ~28,149 |
| Skill references | 21 | 142,893 | ~40,827 |
| Commands | 7 | 7,630 | ~2,180 |
| Agent definitions | 9 | 107,955 | ~30,844 |
| Agent reference | 1 | 9,038 | ~2,582 |
| Agent memories | 9 | 20,501 | ~5,857 |
| System files | 4 | 21,830 | ~6,237 |
| **Grand Total** | **72** | **~436,942** | **~124,841** |

### Budget Utilization Visual

```
Always-Loaded Budget: 29,750 chars (8,500 tokens)
Actual Usage:         28,573 chars (8,164 tokens)

[===================|=]  96.1%  (UNDER BUDGET)
                    ^
                    Budget ceiling

Breakdown:
Rules          [=============]   65.5%  (18,706 chars)
CLAUDE.md      [====]           20.3%  ( 5,798 chars)
userPrefs      [=]               7.5%  ( 2,143 chars)
Memory         [=]               6.7%  ( 1,926 chars)
```

---

## 10. Methodology Notes

- **Character counts**: `wc -c` on each file (exact byte counts)
- **Token estimation**: chars / 3.5 (standard approximation for English text with markdown formatting)
- **Always-loaded scope**: Files confirmed present in the system-reminder injection of this conversation: global CLAUDE.md, project CLAUDE.md, 6 rules (symlinked from `~/.claude/rules/`), userPreferences.txt, and project MEMORY.md
- **Rules reference file**: `rules/swe/references/agent-coordination-protocols.md` (7,234 chars) is NOT symlinked into `~/.claude/rules/` and is NOT always-loaded -- it is a reference file loaded on demand when rules reference it
- **Rules README**: `rules/README.md` (10,983 chars) is NOT installed as a rule and NOT always-loaded
- **Skill metadata**: The ~5,100 char skill listing in system prompts is platform-generated overhead, not counted in the artifact budget

**Regeneration note**: This report should be regenerated after major context artifact changes (new rules, skill restructuring, CLAUDE.md edits). Run the context-engineer with the same analysis task to produce an updated snapshot.
